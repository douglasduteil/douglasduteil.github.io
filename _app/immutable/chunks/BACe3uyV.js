import{e as o,f as p,g as n,p as u,i as d,j as l,h as _,k as m,m as v,l as b}from"./BQn1SuHz.js";class M{anchor;#s=new Map;#t=new Map;#e=new Map;#a=!0;constructor(e,t=!0){this.anchor=e,this.#a=t}#i=()=>{var e=o;if(this.#s.has(e)){var t=this.#s.get(e),s=this.#t.get(t);if(s)p(s);else{var c=this.#e.get(t);c&&(this.#t.set(t,c.effect),this.#e.delete(t),c.fragment.lastChild.remove(),this.anchor.before(c.fragment),s=c.effect)}for(const[a,i]of this.#s){if(this.#s.delete(a),a===e)break;const f=this.#e.get(i);f&&(n(f.effect),this.#e.delete(i))}for(const[a,i]of this.#t){if(a===t)continue;const f=()=>{if(Array.from(this.#s.values()).includes(a)){var h=document.createDocumentFragment();v(i,h),h.append(d()),this.#e.set(a,{effect:i,fragment:h})}else n(i);this.#t.delete(a)};this.#a||!s?u(i,f,!1):f()}}};ensure(e,t){var s=o,c=b();if(t&&!this.#t.has(e)&&!this.#e.has(e))if(c){var a=document.createDocumentFragment(),i=d();a.append(i),this.#e.set(e,{effect:l(()=>t(i)),fragment:a})}else this.#t.set(e,l(()=>t(this.anchor)));if(this.#s.set(s,e),c){for(const[f,r]of this.#t)f===e?s.skipped_effects.delete(r):s.skipped_effects.add(r);for(const[f,r]of this.#e)f===e?s.skipped_effects.delete(r.effect):s.skipped_effects.add(r.effect);s.add_callback(this.#i)}else _&&(this.anchor=m),this.#i()}}export{M as B};
